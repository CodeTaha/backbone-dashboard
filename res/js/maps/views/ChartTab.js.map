{"version":3,"sources":["views/ChartTab.coffee"],"names":[],"mappings":"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","file":"../../views/ChartTab.js","sourcesContent":["\n# ChartTab starts here\nChartTab = Backbone.View.extend {\n\ttagName: \"li\"\n\tevents: {\n\n\t\t#\"click a label\": \"focus\"\n\t\t#\"click a.notemplate input\": \"change\"\n\t\t#\"click a.template input\": \"templateChange\"\n\t\t\"click a\": \"templateChange\"\n\t}\n\tinitialize:(options) ->\n\t\t_.bindAll this, 'render', 'appendList', 'change','createPanel', 'unrender','changeReport_Title', 'templateChange', 'focus', 'selectionChange'\n\t\t@parent = options.parent\n\t\t@chartSelectionModel = options.chartSelectionModel\n\t\t@showDataAutomatically = @parent.showDataAutomatically\n\t\tif @model.get(\"template\")\n\t\t\ttemp = @model.get(\"template_data\")\n\t\t\ttemp.template_params = @getQueryParams(temp.url)\n\t\t\t@model.set template_data: temp\n\t\t#console.log \"ChartTab created \"+@model.get(\"report_title\")+\" Template=\"+@model.get(\"template\")\n\t\t#console.log \"Initial data al\", @showDataAutomatically, @model\n\t\t@listenTo(@chartSelectionModel, 'change:formIds', @selectionChange)\n\t\t@model.bind('remove', this.unrender)\n\t\t@model.on(\"change:report_title\",@changeReport_Title)\n\n\n\t# FUNCTION: render() sets checked, loaded and appends chartPanel\n\trender: () ->\n\t\t\t@model.set checked: true\n\t\t\tif @model.get(\"newChart\")\n\t\t\t\t#console.log \"ChartTab->render->newChart\"\n\t\t\t\t@model.set loaded: false\n\t\t\t\t@parent.$el.prepend @createPanel().render().$el\n\t\t\t\t#@chartPanel.newReport_setForm()\n\t\t\telse if @model.get(\"template\")\n\t\t\t\t@model.set loaded: true\n\t\t\t\t@parent.$el.append @createPanel().render().$el\n\t\t\telse\n\t\t\t\t@model.set loaded: true\n\t\t\t\t@parent.$el.append @createPanel().render().$el\n\t\t\t\t@chartPanel.createChartModels()\n\t\t\tthis\n\n\n\t# FUNCTION: createPanel() creates a new view of ChartPanel\n\tcreatePanel: () ->\n\t\t@chartPanel = new poimapper.views.ChartPanel(\n\t\t\tmodel: @model\n\t\t\tparent: this\n\t\t\tsuperParent: @parent\n\t\t\tchartSelectionModel: @chartSelectionModel\n\t\t)\n\n\t\treturn @chartPanel\n\n\n\t# FUNCTION: appendList() Appends and <li> in the dropdown menu\n\tappendList:() ->\n\t\ttempclass = ''\n\t\tif @model.get(\"template\")\n\t\t\ttempclass = 'template'\n\t\telse\n\t\t\ttempclass = 'notemplate'\n\t\tchk = 'checked'\n\t\tif !@model.get(\"checked\")\n\t\t\tchk = ''\n\n\t\t@$el.append @li_template({\n\t\t\t\"report_title\": @model.get(\"report_title\")\n\t\t\t\"report_id\": @model.get(\"report_id\")\n\t\t\t\"checked\": chk\n\t\t\t\"tempclass\": tempclass\n\t\t})\n\t\t@$(\"i\").hide()\n\t\treturn this\n\n\n\t# FUNCTION: selectionChange() whenever formIds changes in chartSelectionModel, it loads all the templates that have the corresponding charts selected\n\tselectionChange:()->\n\t\tpoi = @model.get(\"template_data\").template_params.poi\n\t\tformIds = @chartSelectionModel.get(\"formIds\")\n\t\t#console.log \"model changed\", @model.get(\"template_data\").template_params.poi, @chartSelectionModel.get(\"formIds\")\n\t\t# if autoload is false, it wont load\n\n\t\tif @chartSelectionModel.get(\"formIds\").length is 0 #if no formIds selected in leftPanel, show all saved Reports\n\t\t\t@$el.removeClass \"filtered\"\n\t\t\t#@$el.show()\n\t\telse if @model.get(\"template\") and !@model.get(\"loaded\") and formIds.indexOf(poi)==-1 #if svaedReports does not belong to the selected formIds and is not loaded then hide\n\t\t\t@$el.addClass \"filtered\"\n\t\telse\n\t\t\t@$el.removeClass \"filtered\"\n\t\t\t#@$el.show()\n\t\t\t\n\t\t# remove false to load data automatically if form is selected\n\t\tif false and @showDataAutomatically and @model.get(\"template\") and !@model.get(\"loaded\") and formIds.indexOf(poi)!=-1\n\t\t\t#console.log \"model changed\", @model.get(\"template_data\").template_params.poi, @chartSelectionModel.get(\"formIds\")\n\t\t\t#console.log @chartSelectionModel, @model\n\t\t\t@templateChange()\n\t\treturn\n\n\n\tfocus: () ->\n\t\tif @model.get(\"loaded\")\n\t\t\tlocation.hash = \"#\" + @model.get(\"report_id\")\n\t\t\treturn true\n\t\telse\n\t\t\treturn @templateChange()\n\n\tchange: () ->\n\t\t@model.set checked: !@model.get(\"checked\")\n\n\t\tchk = @model.get(\"checked\")\n\t\tself = this\n\t\tsetTimeout (->\n\t\t\tself.$('.chkbox').prop 'checked', chk\n\t\t\tself.chartPanel.show_hide()\n\t\t\treturn\n\t\t), 0\n\t\tfalse\n\n\ttemplateChange: () ->\n\t\tif @model.get(\"loaded\")\n\t\t\treturn @change()\n\t\telse\n\t\t\t#$(evt.currentTarget).parent().toggleClass('active');\n\t\t\t@$(\"i\").show()\n\t\t\tchk = true\n\t\t\tself = this\n\t\t\tsetTimeout (->\n\n\t\t\t\tself.$el.toggleClass('active')\n\t\t\t\tself.$('.chkbox').prop 'checked', chk\n\t\t\t\tself.render()\n\t\t\t\tself.chartPanel.fetchReport(()->\n\t\t\t\t\tself.$(\"i\").hide()\n\t\t\t\t\tself.$el.toggleClass('active')\n\t\t\t\t\tself.chartPanel.createChartModels()\n\t\t\t\t)\n\t\t\t\treturn\n\t\t\t), 0\n\n\n\t\t\t###\n\t\t\tsetTimeout (->\n\t\t\t\ttemplate_url = \"#{baseUrl}app/jasper/#{t_par.poi}/#{t_par.includelocation}/#{t_par.newdata}/#{t_par.chart}/#{t_par.type}?key=\" + key + \"&userid=\"+ username + \"&user_id=\"+ user_id + \"&questions=\" + t_par.questions + \"&locs=\" + t_par.locs + \"&levels=\" + t_par.levels + \"&users=\" + t_par.users + \"&fromdate=\" + t_par.fromdate + \"&todate=\" + t_par.todate + \"&timeinfo=\" + t_par.timeinfo + \"&userinfo=\" + t_par.userinfo + \"&legendid=\" + t_par.legendid + \"&reportType=\" + t_par.reportType + \"&locationLevels=\" + t_par.locationLevels + \"&combinenumericfields=\" + t_par.combinenumericfields + \"&timeseriestype=\" + t_par.timeseriestype + \"&locationLevelDataFilter=\" + t_par.locationLevelDataFilter + \"&orientation=\" + t_par.orientation + \"&rowquestionid=\" + t_par.rowquestionid + \"&groupid=\" + t_par.groupid + \"&format=json&excludenull=\" + t_par.excludenull + \"&subgroup=\" + t_par.subgroup\n\t\t\t\t$.ajax\n\t\t\t\t\ttype: \"GET\",\n\t\t\t\t\tasync: false,\n\t\t\t\t\turl: template_url#self.model.get(\"template_data\").url,\n\t\t\t\t\tsuccess: (result) ->\n\n\t\t\t\t\t\tself.model.set data: result\n\t\t\t\t\t\tself.render()\n\t\t\t\t\t\tself.$el.toggleClass('active')\n\t\t\t\t\t\t#console.log \"Template Data=\",self.model, template_url\n\n\t\t\t), 0\n\t\t\t###\n\n\t\t\tfalse\n\n\tunrender: () ->\n\t\t@$el.remove()\n\n\t# Changes the name of report title in li\n\tchangeReport_Title: () ->\n\t\t@$(\"label\").html @model.get(\"report_title\")\n\n\tli_template:_.template '\n\t\t\t<a href=\"\\#{{ report_id }}\" class=\"{{tempclass}}\">\n\t\t\t\t<input class=\"chkbox\" type=\"checkbox\" {{checked}} aria-label=\"...\">\n\t\t\t\t<i class=\\'fa fa-circle-o-notch fa-spin\\'></i>\n\t\t\t\t<label>{{ report_title }}</label>\n\t\t\t</a>\n\t'\n\n\t# Helper Functions\n\t# getQueryParams extracts the template parameters from the url\n\tgetQueryParams : (qs) ->\n\t\tparams = undefined\n\t\tre = undefined\n\t\ttokens = undefined\n\t\tqs = qs.split('+').join(' ')\n\t\t#preqs= qs.split('?').slice(1)\n\t\tpreqs = []\n\t\tpreqs[0] = qs.substring(0, qs.indexOf('?'))\n\t\tpreqs[1] = qs.substring(qs.indexOf('?') + 1)\n\t\tpath_params = preqs[0].split('/').slice(4)\n\t\tqs = preqs[1]\n\t\tparams = {}\n\t\ttokens = undefined\n\t\tre = /[?&]?([^=]+)=([^&]*)/g\n\t\twhile tokens = re.exec(qs)\n\t\t\tparams[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2])\n\t\tparams.poi = path_params[0]\n\t\tparams.includelocation = path_params[1]\n\t\tparams.newdata = path_params[2]\n\t\tparams.chart = path_params[3]\n\t\tparams.type = path_params[4]\n\t\t# To disable location data from templates\n\t\tparams.locs = ''\n\t\t#params.levels = '' #Not sure if needed\n\t\tparams.users = ''\n\t\tparams.fromdate = ''\n\t\tparams.todate = ''\n\t\tparams\n}\n# ChartTab ends here\n# export the following globals\nroot = window or this\nunless root.poimapper?\n\troot.poimapper = {}\n\nunless root.poimapper.views?\n\troot.poimapper.views = {}\n\nroot.poimapper.views.ChartTab = ChartTab\n"]}