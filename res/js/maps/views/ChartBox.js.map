{"version":3,"sources":["views/ChartBox.coffee"],"names":[],"mappings":"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","file":"../../views/ChartBox.js","sourcesContent":["# ChartBox starts here\nChartBox = Backbone.View.extend {\n\ttagName: 'div'\n\tclassName: 'col-sm-6 col-md-6 col-lg-4'\n\tevents: {\n\t\t\"click button.maxButton\": \"maxMinChart\" #whenever the titlebar of chartbox is clicked, the chart is maximized\n\t\t\"click button.download\": \"downloadChart\"\n\t}\n\tinitialize: (options) ->\n\t\t_.bindAll this, 'render', 'unrender', 'maxMinChart', 'createChart', 'downloadChart'\n\t\t@chart =\tnew Chart\n\t\t@parent = options.parent\n\t\t@model.bind('remove', this.unrender)\n\t\t@maxMinFlag = false #for maximizing minimizing charts\n\trender: () ->\n\t\tswitch @model.get(\"chart_type\")\n\t\t\twhen 'bar'\n\t\t\t\t@chart_type='bar'\n\t\t\twhen 'pie'\n\t\t\t\t@chart_type='pie'\n\t\t\n\t\tlocation = if @model.get(\"location\") != null then \"<span class='glyphicon glyphicon-map-marker' aria-hidden='true'></span>\"+@model.get(\"location\") else \"<h5>&nbsp;</h5>\"\n\t\t#console.log(\"location\", @model.attributes, location)\n\t\tif !@model.get(\"loc_title\")?\n\t\t\t$(@el).html @viz_template({\n\t\t\t\t\"graph_title\": @model.get(\"title\"),\n\t\t\t\t\"counter\": @model.cid,\n\t\t\t\t\"chart_type\": @chart_type+\"_c\",\n\t\t\t\t\"data_id\": @model.cid,\n\t\t\t\t\"pois\": @model.get(\"no_of_pois\")\n\t\t\t})\n\t\telse\n\t\t\t$(@el).html @viz_template({\n\t\t\t\t\"graph_title\": location,\n\t\t\t\t\"counter\": @model.cid,\n\t\t\t\t\"chart_type\": @chart_type+\"_c\",\n\t\t\t\t\"data_id\": @model.cid,\n\t\t\t\t\"pois\": @model.get(\"no_of_pois\")\n\t\t\t})\n\t\tthis\n\n\n\t# FUNCTION: unrender() On refresh when previous chart models are deleted, this function is called due to bind on remove, which removes the chartBox from the panel\n\tunrender: ()->\n\t\t@$el.remove()\n\n\t# Saves SVG as .png for download\n\tdownloadChart: () ->\n\t\t@$el.append('<canvas id=\"drawingArea\"></canvas>')\n\t\t#console.log \"Save this svg\", \"#viz_\"+@model.cid, $(\"#viz_\"+@model.cid+\" svg\").html()\n\t\tconsole.log \"Download\", @model\n\t\tcanvg(document.getElementById('drawingArea'),'<svg class=\"'+@chart_type+\"_c\"+'\" width=\"'+$(\"#viz_\"+@model.cid+\" svg\").width()+'\" height=\"'+$(\"#viz_\"+@model.cid+\" svg\").height()+'\">'+$(\"#viz_\"+@model.cid+\" svg\").html()+'</svg>')#, {scaleWidth:20, scaleHeight:12})\n\t\tcanvas = document.getElementById('drawingArea')\n\t\timg\t\t= canvas.toDataURL(\"image/png\")\n\t\tlink = document.createElement(\"a\")\n\t\tlink.download = @model.get(\"title\").replace(/[^A-Z0-9]+/ig, \"_\")+\".png\"\n\t\t\n\t\tif @model.get(\"location\")?\n\t\t\tlink.download = @model.get(\"title\").replace(/[^A-Z0-9]+/ig, \"_\")+\"-\"+@model.get(\"location\").replace(/[^A-Z0-9]+/ig, \"_\")+\".png\"\n\t\tlink.href = img\n\t\tlink.click()\n\t\t@$(\"#drawingArea\").remove()\n\n\t# Creates the chart based on chart_type\n\tcreateChart: () ->\n\t\t#console.log(\"createChart\", @model)\n\t\tswitch @chart_type\n\t\t\twhen 'bar'\n\t\t\t\t@bar((err, success)->\n\t\t\t\t\treturn)\n\t\t\twhen 'pie'\n\t\t\t\t@pie((err, success)->\n\t\t\t\t\treturn)\n\n\t# maximizes chart size on click\n\tmaxMinChart: () ->\n\t\t@maxMinFlag = !@maxMinFlag\n\t\tif @maxMinFlag\n\t\t\t@$el.removeClass()\n\t\t\t\t\t.addClass(\"col-sm-12 col-md-12 col-lg-12 maximizeChart\")\n\t\t\t@$(\".\"+@chart_type+\"_c\").empty()\n\n\t\t\t@$(\".maxButton\").html('<i class=\"fa fa-search-minus\"></i>')\n\t\telse\n\t\t\t@$el.removeClass()\n\t\t\t\t\t.addClass(\"col-sm-6 col-md-6 col-lg-4\")\n\t\t\t@$(\".\"+@chart_type+\"_c\").empty()\n\n\t\t\t@$(\".maxButton\").html('<i class=\"fa fa-search-plus\"></i>')\n\t\t@createChart()\n\n\t# Calls BAR chart\n\tbar: (cb) ->\n\t\t##console.debug \"BAR\", @model, @parent.model\n\t\tdata=@model.get(\"chart_variables\")\n\t\t#For combined numeric fields\n\t\tif @model.get(\"numeric\") is true and @parent.model.get(\"template_data\").template_params.combinenumericfields is \"1\" \n\t\t\t@chart.barCombine \"#viz_\"+@model.cid, data, @maxMinFlag\n\t\telse \n\t\t\t@chart.bar \"#viz_\"+@model.cid, data, \"key\", \"value\", @model.get(\"numeric\"), @maxMinFlag\n\t\tcb null,true\n\n\t# Calls PIE chart\n\tpie: (cb) ->\n\t\tdata=@model.get(\"chart_variables\")\n\t\t@chart.pie \"#viz_\"+@model.cid, data, \"key\", \"value\",@maxMinFlag\n\t\tcb null,true\n\n\t# Calls AREA chart\n\tarea: (cntr, cb) ->\n\t\tdata = undefined\n\t\tparseDate = undefined\n\t\tparseDate = d3.time.format('%d-%b-%y').parse\n\t\tchart_local=@chart \n\t\t@$el.append @viz_template(\n\t\t\t\t'graph_title': 'Area_' + cntr,\n\t\t\t\t'counter': cntr,\n\t\t\t\t'chart_type': 'area_c',\n\t\t\t\t\"data_id\":\"null\"\n\t\t\t\t)\n\t\tdata = d3.json('res/js/areaData.js', (error, data2) ->\n\t\t\tif error\n\t\t\t\tthrow error\n\t\t\tdata2.forEach (d) ->\n\t\t\t\td.date = parseDate(d.date)\n\t\t\t\td.close = +d.close\n\t\t\t\treturn\n\t\t\tchart_local.area '#viz_' + cntr, data2, 'date', 'close'\n\t\t\tdata2\n\t\t)\n\n\t\tcb null, true\n\n\t# Calls LINE chart\n\tline: (cntr, cb) ->\n\t\tparseDate = d3.time.format('%d-%b-%y').parse\n\t\t@$el.append @viz_template(\n\t\t\t'graph_title': 'Line' + cntr\n\t\t\t'counter': cntr\n\t\t\t'chart_type': 'line_c'\n\t\t\t'data_id': 'null')\n\t\tchart_local=@chart\n\t\tdata = d3.json('res/js/areaData.js', (error, data2) ->\n\t\t\tif error\n\t\t\t\tthrow error\n\t\t\tdata2.forEach (d) ->\n\t\t\t\td.date = parseDate(d.date)\n\t\t\t\td.close = +d.close\n\t\t\t\treturn\n\t\t\tchart_local.line '#viz_' + cntr, data2, 'date', 'close'\n\t\t\tdata2\n\t\t)\n\n\t\tcb null, true\n\n# Template used to render .well\twith charts for chartBoxes\n\tviz_template:_.template '\n\t\t\t\t\t\t\t<div class=\"well chartBox\">\n\t\t\t\t\t\t\t\t<div class=\"chartTitle row-fluid\">\n\t\t\t\t\t\t\t\t\t<div class=\"col-md-8 graphTitle\" title=\"{{ graph_title }}\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t\t\t\t\t\t<h5>{{ graph_title }}</h5>\n\t\t\t\t\t\t\t\t\t\t\t<h6>POI\\'s: {{ pois }}</h6>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button type=\\\"button\\\" class=\\\"btn btn-xs btn-default download\\\" style=\"float:right;\">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\\\"fa fa-download\\\"></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t<!--<button type=\"button\" class=\"btn btn-xs btn-default maxButton\" aria-label=\"Maximize\" style=\"float:right;\" data-target=\"#maxModal\" data-toggle=\"modal\" data-id=\"{{data_id}}\">-->\n\t\t\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-xs btn-default maxButton\" aria-label=\"Maximize\" style=\"float:right;\">\n\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-search-plus\"></i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"{{chart_type}}\" id=\\\"viz_{{ counter }}\\\">\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>'\n}\n# ChartBox ends here\n\n# export the following globals\nroot = window or this\nunless root.poimapper?\n\troot.poimapper = {}\n\nunless root.poimapper.views?\n\troot.poimapper.views = {}\n\nroot.poimapper.views.ChartBox = ChartBox\n"]}